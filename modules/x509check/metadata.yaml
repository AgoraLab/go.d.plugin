name: x509check
title: x509 certificate collector
overview:
  application:
    description: |
      An X.509 certificate is a digital certificate based on the widely accepted International Telecommunications Union (ITU) X.509 standard.

  collector:
    description: |
      This module checks the time until an x509 certificate expires and its revocation status.

      Information about X509 certificates can be collected through a local file, TCP, UDP, HTTPS or SMTP protocols.
setup:
  prerequisites:
    list: []

  configuration:
    options:
      description: |
        The following options can be defined globally: update_every, autodetection_retry.
      folding:
        title: All options
        enabled: true
      list:
        - name: update_every
          description: Data collection frequency.
          default: 1
          required: no
        - name: autodetection_retry
          description: Re-check interval in seconds. Zero means not to schedule re-check.
          default: 0
          required: no
        - name: source
          description: "Certificate source. Allowed schemes: https, tcp, tcp4, tcp6, udp, udp4, udp6, file."
          default: ""
          required: yes
        - name: days_until_expiration_warning
          description: Number of days before the alarm status is warning.
          default: 30
          required: no
        - name: days_until_expiration_critical
          description: Number of days before the alarm status is critical.
          default: 15
          required: no
        - name: check_revocation_status
          description: Whether to check the revocation status of the certificate.
          default: no
          required: no
        - name: timeout
          description: SSL connection timeout.
          default: 2
          required: no
        - name: tls_skip_verify
          description: Whether to skip verifying server's certificate chain and hostname.
          default: no
          required: no
        - name: tls_ca
          description: Certificate authority that client use when verifying server certificates.
          default: "-"
          required: no
        - name: tls_cert
          description: Client tls certificate.
          default: "-"
          required: no
        - name: tls_key
          description: Client tls key.
          default: "-"
          required: no
    examples:
      list:
        - name: Website certificate
          description: Website certificate.
          folding:
            title: Example
            enabled: true
          data: |
            jobs:
              - name: my_site_cert
                source: https://my_site.org:443
        - name: Local file certificate
          description: Local file certificate.
          folding:
            title: Example
            enabled: true
          data: |
            jobs:
              - name: my_file_cert
                source: file:///home/me/cert.pem
        - name: SMTP certificate
          description: SMTP certificate.
          folding:
            title: Example
            enabled: true
          data: |
            jobs:
              - name: my_smtp_cert
                source: smtp://smtp.my_mail.org:587
        - name: Multi-instance
          description: |
            > **Note**: When you define more than one job, their names must be unique.

            Check the expiration status of the multiple websites' certificates.
          folding:
            title: Example
            enabled: true
          data: |
            jobs:
              - name: my_site_cert1
                source: https://my_site1.org:443

              - name: my_site_cert2
                source: https://my_site1.org:443

              - name: my_site_cert3
                source: https://my_site3.org:443
troubleshooting:
  problems:
    list: []
metrics:
  folding:
    title: Metrics
    enabled: false
  description: TBD
  scope:
    - name: global
      description: TBD
      labels:
        - name: source
          description: TBD
      metrics:
        - name: x509check.time_until_expiration
          description: Time Until Certificate Expiration
          unit: seconds
          dimensions:
            - name: expiry
        - name: x509check.revocation_status
          description: Revocation Status
          unit: boolean
          dimensions:
            - name: revoked
